<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom New Tab</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@100;300&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      width:100%;height:100vh;
      background:url("cah.png") no-repeat center center fixed;
      background-size:cover;
      display:flex;flex-direction:column;align-items:center;
      font-family:'Segoe UI',sans-serif;color:black;
    }
    .spacer{flex:0 0 15%}
    .time{
      font-size:5em;font-weight:200;margin-bottom:0.1em;
      text-shadow:0 2px 6px rgba(255,255,255,0.6);
    }
    .date{
      font-size:2em;font-weight:200;margin-bottom:2em;
      text-shadow:0 2px 6px rgba(255,255,255,0.6);
    }
    .search-container{
      display:flex;align-items:center;
      backdrop-filter:blur(12px);
      background:rgba(255,255,255,0.2);
      border-radius:50px;
      padding:0.2em 1em;
      width:50%;max-width:600px;min-width:280px;
      box-shadow:0 4px 20px rgba(0,0,0,0.3);
    }
    .search-container input{
      flex:1;background:transparent;border:none;outline:none;
      font-size:1em;color:black;
    }
    .search-container button{
      background:none;border:none;cursor:pointer;
      font-size:1.2em;color:black;
    }
    .ip{
      position:fixed;bottom:15px;left:20px;
      font-size:0.9em;color:black;
      text-shadow:0 1px 4px rgba(255,255,255,0.8);
    }
  </style>
</head>
<body>
  <div class="spacer"></div>
  <div class="time" id="time"></div>
  <div class="date" id="date"></div>
  <div class="search-container">
    <input type="text" id="searchBox" placeholder="Search Google...">
    <button onclick="doSearch()">&#128269;</button>
  </div>
  <div class="ip" id="ip">Loading IP...</div>
  <script>
    function updateTime(){
      let now=new Date();
      let hrs=now.getHours()%12||12;
      let mins=String(now.getMinutes()).padStart(2,'0');
      let ampm=now.getHours()>=12?"PM":"AM";
      document.getElementById("time").textContent=`${hrs}:${mins} ${ampm}`;
      let options={weekday:"long",year:"numeric",month:"long",day:"numeric"};
      let [weekday,month,day,year]=now.toLocaleDateString("en-US",options).split(" ");
      document.getElementById("date").textContent=`${weekday.replace(",","")}, ${month} ${day.replace(",","")}`;
    }
    setInterval(updateTime,1000);updateTime();
    function doSearch(){
      let q=document.getElementById("searchBox").value.trim();
      if(q)window.location.href="https://www.google.com/search?q="+encodeURIComponent(q);
    }
    document.getElementById("searchBox").addEventListener("keypress",e=>{
      if(e.key==="Enter")doSearch();
    });
    async function fetchIP(){
      try{
        let res=await fetch("https://api.ipify.org?format=json");
        let data=await res.json();
        localStorage.setItem("lastIP",data.ip);
        document.getElementById("ip").textContent=data.ip;
      }catch(e){
        let cached=localStorage.getItem("lastIP");
        document.getElementById("ip").textContent=cached?cached+" (cached)":"Offline";
      }
    }
    fetchIP();
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
        const CACHE_NAME="newtab-cache-v1";
        self.addEventListener("install",e=>{e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(["./","cah.png"])));});
        self.addEventListener("fetch",e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(resp=>{
          let respClone=resp.clone();caches.open(CACHE_NAME).then(c=>c.put(e.request,respClone));return resp;})));});
      `],{type:"application/javascript"})));
    }
  </script>
</body>
</html>
